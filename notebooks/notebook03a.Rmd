---
title: "Notebook 03A"
output: html_document
---

```{r, include=FALSE}
library(tidyverse)
library(ggrepel)
library(smodels)

theme_set(theme_minimal())
options(pillar.min_character_chars = 15)
```

## Instructions

This notebook includes several tasks to practice and extend your knowledge of
the material covered within the chapter. For the most part, every notebook with
a name ended in "A" will work with a collection of data about cities and their
population. The questions tend to be relatively contained; the focus is
primarily on writing code to perform a specific task. For this purpose there
will usually be an empty code block for you to put your code. There are also
questions requiring a short response, prompted by the phrase "**Answer:**".
Your answers to these can be write directly in this notebook. Occasionally
new functions or concepts will be shown within each notebook.

Notebooks ending in letters other than "A" more often include new datasets and
open-ended prompts for using the data skills covered in the chapters to address
a wide range of questions. It is suggested to start with the "A" notebook for
each chapter and then trying to work through at least one additional data
project notebook.

When you are done with your code, hitting the *knit* button in the toolbar will
produce an HTML webpage with all of your results. Note that the first time you
run the knit function may require installing some packages. Knitting your code
is a good way to help check that you have written all of the code correctly and
have not accidentally modified anything as you worked through the notebook.

Two important pieces of advice when working through the notebooks:

- It is a best practice to close RStudio everytime that you finish with a
notebook and before you start working on another dataset. This starts each
notebook from scratch and does not risk accidentally using variables created in
one notebook within the scope of another.

- Notice that the notebook file does not automatically word-wrap the way you
may be used to in a word processor. Generally, you should manually hit enter to
start typing on a new line. I try to make sure that both my text and my code are
not very wide. Make sure to do the same with your code and responses. Also, make
sure that your notebook window is wide enough so that my text does not forceable
try to wrap. This is very hard to read and makes it much easier to work through
the notebook.

## Load Datasets

We will work with the largest cities datasets:

```{r, message=FALSE}
cities <- read_csv(file.path("..", "data", "largest_cities.csv"))
```

For the U.S. city population over time, this time we will select three
cities of data (Boston, Chicago, and LA) to work with:

```{r, message=FALSE}
us_three <- read_csv(file.path("..", "data", "us_city_population.csv")) %>%
  filter(city %in% c("Boston, MA", "Chicago, IL", "Los Angeles, CA"))
```

Please refer to notebook02a for more information about these datasets and how
these datasets are organized.

## Color and Size

In the code below, produce a scatter plot with longitude on the x-axis and latitude
on the y-axis. Make the points scale with the size of the city's population.

```{r}

```

What region(s) seem to have the highest concentration of large cities? **Answer**:

Below, repeat the same plot but now scale the color (not the size) of the points based
on the population.

```{r}

```

Which of these two plots (color or size) do you find easier to read? Why?
**Answer**:

In the code below, plot the cities data with the city longitude on the x-axis and
latitude on the y-axis. Color the points based on the continent the city is in and
make the size proportional to the population.

```{r}

```

What "holes" in the map exist? That is, what are some large regions have no cities
in the dataset that you tend to expect to find on a map? **Answer**:

## Group Aesthetic

In this section, we will use the `us_three` dataset. In the code below,
produce a line plot with year on the x-axis and population on the y-axis.

```{r}

```

You should see a strange plot that seems to have a jagged, comb-like pattern to
it. Below, repeat this plot but add a points layer that is colored by the city
name (do not add color yet to the lines)

```{r}

```

Can you see what's happening now? The line plot is drawing a single line,
from the smallest year to the largest year, without ever lifting up it's pen.
It's connecting across time and space, producing a plot that is nearly
meaningless (or at least, very hard to interpret).

In the code below, produce a line plot with year on the x-axis and population
on the y-axis. Color the lines by city. Do not include a points layer.

```{r}

```

This plot should now look a lot nicer as it shows a different line for each city.
To understand what is going on, produce the same plot in the code below, but
replace the `color` aes with a new aes called `group`. In other words, map the
`group` aesthetic to the city aesthetic.

```{r}

```

You should now see three lines that are all in black. It is this exact plot that was
being colored in the previous example.

What's going on here? When we add aesthetics such as color and size to a line geometry,
another aesthetic called `group` is magically set at the same time. It is possible to
set this aesthetic explicitly if we want to group the data without producing a different
size of color.

## Fixed Aesthetics

For pratice, return to the `cities` dataset. Produce a scatter plot with longitude
and latitude, but color all of the points the color "pink".

```{r}

```

Starting from the plot in the previous question, modify the size of the points to
change with the population of each city.

```{r}

```

Another aesthetic value that was not covered in the chapter is called `alpha`.
It is given by a number between 0 and 1 and sets how opaque the points are shown.
Most typically it is used as a fixed aesthetic to make a plot with a large number
of points more readable. Starting with the plot in the previous question, add a
fixed aesthetic to change the alpha value of the points to 0.4.

```{r}

```

Notice how the areas where multiple cities overlap are darker than the surrounding regions.

## Scales

With the `cities` dataset, produce a scatter plot with city area on the x-axis and city
population on the y-axis.

```{r, warning=FALSE}

```

You should find that it is difficult to interpret this plot because most of the cities are
squished together on the left-side of the plot. One way to fix this is to use a logarithmic
scale. In the code block below, provide a modification of this plot with logarithmic scales
for the x- and y-axes.

```{r}

```

You should find this plot easier to work with. If you are not familiar with
the scientific notation used on the x-axis labels here, make sure to
[learn more about these](https://en.wikipedia.org/wiki/Scientific_notation)
as they will appear from time-to-time throughout the notes in this book.

## Color Scales

The Köppen climate classification is a way of describing the climate of a region
or city. Information about these scores are included in the `cities` dataset and
are something that we will explore in length in future notebooks. Here we will
work with the four level categorization stored in the variable `koppen_main`
(there are actually five levels, but the coldest level is not present in this
dataset).

In the code block below, produce a scatter plot of the `cities` dataset with longitude
on the x-axis  and latitude on the y-axis. Color the points pased on the `koppen_main`
variable.

```{r}

```

In the code below, modify this plot to use the color-blind friendly Viridis color
scale:

```{r}

```

There is a well-known and standardized color scale for the Köppen codes. We will
use the full palette in a future notebook; here we will just set values for the
four main categories. In the code below repeat the scatterplot, but add a manual
color scale where the "Tropical" climates are blue, the "Dry" climates are red,
"Temperate" is green and "Continental" is purple.

```{r}

```
