---
title: "Notebook 02A"
output: html_document
---

```{r, include=FALSE}
library(tidyverse)
library(ggrepel)
library(smodels)

theme_set(theme_minimal())
options(pillar.min_character_chars = 15)
```

## Instructions

This notebook includes several tasks to practice and extend your knowledge of
the material covered within the chapter. For the most part, every notebook with
a name ended in "A" will work with a collection of data about cities and their
population. The questions tend to be relatively contained; the focus is
primarily on writing code to perform a specific task. For this purpose there
will usually be an empty code block for you to put your code. There are also
questions requiring a short response, prompted by the phrase "**Answer:**".
Your answers to these can be write directly in this notebook. Occasionally
new functions or concepts will be shown within each notebook.

Notebooks ending in letters other than "A" more often include new datasets and
open-ended prompts for using the data skills covered in the chapters to address
a wide range of questions. It is suggested to start with the "A" notebook for
each chapter and then trying to work through at least one additional data
project notebook.

When you are done with your code, hitting the *knit* button in the toolbar will
produce an HTML webpage with all of your results. Note that the first time you
run the knit function may require installing some packages. Knitting your code
is a good way to help check that you have written all of the code correctly and
have not accidentally modified anything as you worked through the notebook.

Two important pieces of advice when working through the notebooks:

- It is a best practice to close RStudio everytime that you finish with a
notebook and before you start working on another dataset. This starts each
notebook from scratch and does not risk accidentally using variables created in
one notebook within the scope of another.

- Notice that the notebook file does not automatically word-wrap the way you
may be used to in a word processor. Generally, you should manually hit enter to
start typing on a new line. I try to make sure that both my text and my code are
not very wide. Make sure to do the same with your code and responses. Also, make
sure that your notebook window is wide enough so that my text does not forceable
try to wrap. This is very hard to read and makes it much easier to work through
the notebook.

## Largest Cities Dataset

We will work with the largest cities dataset again in this notebook.

```{r, message=FALSE}
cities <- read_csv(file.path("..", "data", "largest_cities.csv"))
cities
```

Remember that population numbers are given in millions and areas are given in
square kilometers. The three different kinds of populations refer to different
ways of describing what is included in a city. The variable `population` is a
measurment from the UN (2018) that tries to consistently define the region of
a city. More information is available in the U.N.'s World Urbanization Prospectus
[available here](https://population.un.org/wup/Publications/Files/WUP2018-Highlights.pdf).
The other three measurements refer to:

- **city**: city proper, defined by local administrative boundaries
- **metro**: according to UNICEF, the Metro Region is an area "comprising the
urban area as a whole and its primary commuter areas... In addition to the city proper,
a metropolitan area includes both the surrounding territory with urban levels of
residential density and some additional lower-density areas that are adjacent to and
linked to the city." See [UNICEF](https://www.unicef.org/sowc2012/statistics.php) for
more information.
- **urban**: an area that consists of a "continuously built up land mass of urban
development that is within a labor market (metropolitan area or metropolitan region)
and contains no rural land". 

Several of the questions in this and the following notebooks concern the analysis
of the relationship between these various definitions.

## Scatter Plot

In the code below, write the code to produce a scatterplot with population on
the x-axis and the city population on the y-axis.

```{r, warning=FALSE}

```

Now, in the code region below, produce a scatter plot with population on the x-axis
and metro population on the y-axis. 

```{r, warning=FALSE}

```

Which of the two regional populations (metro or city) seem to more closely relate
to the U.N.'s definition of a cities population (e.g., the `population` variable).
**Answer**:

## Text Plot

Produce a plot with a text geometry where longitude (`lon`) is on the x-axis, latitude
is on the y-axis (`lat`), and the labels are given by the city names (`name`).

```{r}

```

This should roughly resemble a map of the world. In the code below, produce
a modified version of this plot, replacing the text layer with a text repel
layer.

```{r}

```

Which of these two plots do you find easier to read, and why? (Note, there is no
clear correct answer here). **Answer**:

## Layering Plots

Produce a scatter plot with population on the x-axis, and metro population on the
y-axis. Add an additional text repel layer with labels given by the city names.

```{r, warning=FALSE}

```

Name (at least) two cities where the metropolitan population is more than the
U.N. official population. **Answer**:

Name (at least) two cities where the U.N.'s official population is greater than
the listed metropolitan area's population. **Answer**:

## U.S. Cities

Now, we will look at a new dataset. This also concerns the population of cities,
but here we have the population over a 220 year period, but only from a collection
of cities in the current-day United States. For today, we will take a subset of the
data to only include the city of Boston. There is no need to understand the code
used to take this subset; we will cover the syntax in Chapter 4.

```{r, message=FALSE}
boston <- read_csv(file.path("..", "data", "us_city_population.csv")) %>%
  filter(city == "Boston, MA")
boston
```

The population variable gives the population of the city in a given year in thousands
of people. The other variables---city, state, year, longitude, and latitude---should
be self-explanatory.

## Line and Column Plots

Using the Boston dataset, make a plot with year on the x-axis and population on the 
y-axis. Include both a line and a point layer.

```{r}

```

In what year does Boston appear to have the largest population? **Answer**:

If you are curious about some of the causes in the drop in the population, 
I suggest taking a look at the Wikipedia page on
[White flight](https://en.wikipedia.org/wiki/White_flight) and the University
of Richmond's Digital Scholarship Lab's excellent digital project titled
[Renewing Inequality](http://dsl.richmond.edu/panorama/renewal/).

Another geometry that is good at capturing the pattern seen in the plot is called
`geom_col`. In the code below, create a plot with year on the x-axis and population
on the y-axis using a `geom_col` layer.

```{r}

```

Here, the plot works well. It is not immediately clear if it is more-or-less useful
than the line plot. In future chapters, we will see that this geometry is particularly
useful for certain kinds of data.
