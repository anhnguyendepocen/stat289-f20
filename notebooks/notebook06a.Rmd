---
title: "Notebook 06A"
output: html_document
---

```{r, include=FALSE}
library(tidyverse)
library(ggrepel)
library(smodels)

theme_set(theme_minimal())
options(pillar.min_character_chars = 15)
```

## Instructions

This notebook includes several tasks to practice and extend your knowledge of
the material covered within the chapter. For the most part, every notebook with
a name ended in "A" will work with a collection of data about cities and their
population. The questions tend to be relatively contained; the focus is
primarily on writing code to perform a specific task. For this purpose there
will usually be an empty code block for you to put your code. There are also
questions requiring a short response, prompted by the phrase "**Answer:**".
Your answers to these can be write directly in this notebook. Occasionally
new functions or concepts will be shown within each notebook.

Notebooks ending in letters other than "A" more often include new datasets and
open-ended prompts for using the data skills covered in the chapters to address
a wide range of questions. It is suggested to start with the "A" notebook for
each chapter and then trying to work through at least one additional data
project notebook.

When you are done with your code, hitting the *knit* button in the toolbar will
produce an HTML webpage with all of your results. Note that the first time you
run the knit function may require installing some packages. Knitting your code
is a good way to help check that you have written all of the code correctly and
have not accidentally modified anything as you worked through the notebook.

Two important pieces of advice when working through the notebooks:

- It is a best practice to close RStudio everytime that you finish with a
notebook and before you start working on another dataset. This starts each
notebook from scratch and does not risk accidentally using variables created in
one notebook within the scope of another.

- Notice that the notebook file does not automatically word-wrap the way you
may be used to in a word processor. Generally, you should manually hit enter to
start typing on a new line. I try to make sure that both my text and my code are
not very wide. Make sure to do the same with your code and responses. Also, make
sure that your notebook window is wide enough so that my text does not forceable
try to wrap. This is very hard to read and makes it much easier to work through
the notebook.

## Load Datasets

We will work with the largest cities datasets:

```{r, message=FALSE}
cities <- read_csv(file.path("..", "data", "largest_cities.csv"))
```

We will also work with the entire U.S. cities dataset:

```{r, message=FALSE}
us <- read_csv(file.path("..", "data", "us_city_population.csv"))
```

Please refer to notebook02a for more information about these datasets and how
these datasets are organized.

## Creating new numeric variables

Using the `cities` dataset, create a new variable named `city_density` by
dividing the city population by the city area. Use the `select` function
to select the city name, population, area, and density.

```{r}

```

The numbers here are very small. What units is the variable `city_density`
currently in? **Answer**:

Below, modify your code by multiplying the city density by 1000.

```{r}

```

Now what are the units of the city density variable? **Answer**:

Now, summarize the average city density by continent.

```{r}

```

Western media often shows images of overcrowded cities in Asia and Africa. Does
this image of population density follow from the data? **Answer**:

Now, below, using the mutate verb, create a plot with city density on the x-axis
and metro density on the y-axis. Use a log scale for the axes and include points
and text repel labels with the city names.

```{r, warning=FALSE}

```

What two outliers stick out in this plot? **Answer**:

## Creating new categorical variables

Create a bat plot of the `koppen_code` variable in the `cities` dataset with the
categories ordered from largest to smallest. The code are short so there should be
no need to flip the axes in the plot.

```{r}

```

In the code below, create a new variable called `hemisphere` which is equal to
"North" for cities with a latitude above zero and "South" for cities below zero.
Pipe the data to a plot and color the cities by their hemisphere to verify that
your code is correct.

```{r}

```

Repeat this process below, but this time create a variable called "quadrant" that
is equal to "NE", "NW", "SE", and "SE" depending on the sign of the latitude and
longitude variables. The easiest way to do this is to start by defining a default
value and them fill in the quadrants with four uses of the `if_else` function.
Note: use the `&` operator to combine two conditions (i.e., `(lat > 0) & (lon > 0)`).

As above, pipe the data into a plot colored by quadrant to verify your work.

```{r}

```

## Grouped Mutate

To conclude, we will apply a few grouped versions of the mutate verb. To make
sure we understand how this works, take the `us` dataset, group by city, and 
compute the maximum value of the population variable for each city.

```{r}

```

Note that this added a new column to the original dataset showing the largest
population for each city at any point in time.

Building off of this approach, construct a scatter plot that shows the population
of cities in 2010 on the x-axis and the percentage of the 2010 population compared
to the maximum population of the city from 1790-2010. Filter to only include cities
that are less than 70% of their maximum size in 2010. Use a text repel layer to
label each city. (Note: This will require at least two different calls to the 
mutate function).

```{r}

```


